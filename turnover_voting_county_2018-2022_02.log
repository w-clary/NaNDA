--------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  O:\NaNDA\Data\voting\voting_county_2018-2022\code\turnover_voting_county_2018-2022_02.log
  log type:  text
 opened on:  20 Sep 2024, 11:30:15

. set linesize 120

. 
. ****************************************************************************
. * Section 1: Load working dataset
. pwd
O:\NaNDA\Data\voting\voting_county_2018-2022

. use `workfile', clear

. display "`workfile'"
datasets\workfiles_received\nanda_voting_County20_2018-2022.dta

. 
. ****************************************************************************
. * Section 2: Curation stuff
. * order variables in a way that makes sense:
. * voter turnout components, voter turnout ratios, partisanship components, partisanship ratios
. order fips year, before(a1a)

. order cvap, after(f1a)

. order reg_pct voterturnout balreg, after(cvap)

. order candidatevotes_dv candidatevotes_rv, after(balreg)

. order partisanship_dem_senate, after(partisanship_rep_presidential)

. order partyindexdem partyindexrep, after(partisanship_rep_senate)

. 
. * sort by year then FIPS
. sort year fips

. 
. * rename variables
. rename fips stcofips20

. rename a1a reg_voters

. rename f1a ballots_cast

. rename reg_pct reg_voters_pct

. rename voterturnout voter_turnout_pct

. rename balreg reg_voter_turnout_pct

. rename candidatevotes_dv pres_dem_votes

. rename candidatevotes_rv pres_rep_votes

. rename uss_dv sen_dem_votes

. rename uss_rv sen_rep_votes

. rename partisanship_dem_presidential pres_dem_ratio

. rename partisanship_rep_presidential pres_rep_ratio

. rename partisanship_dem_senate sen_dem_ratio

. rename partisanship_rep_senate sen_rep_ratio

. rename partyindexdem partisan_index_dem

. rename partyindexrep partisan_index_rep

. 
. describe 

Contains data from datasets\workfiles_received\nanda_voting_County20_2018-2022.dta
 Observations:         9,746                  
    Variables:            18                  20 Sep 2024 10:24
------------------------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------------------------
stcofips20      str5    %9s                   FIPS
year            int     %8.0g                 
reg_voters      long    %12.0g                A1a
ballots_cast    long    %12.0g                F1a
cvap            float   %9.0g                 CVAP
reg_voters_pct  float   %9.0g                 
voter_turnout~t float   %9.0g                 VoterTurnOut
reg_voter_tur~t float   %9.0g                 bal/reg
pres_dem_votes  long    %12.0g                
pres_rep_votes  long    %12.0g                
sen_dem_votes   long    %12.0g                USS_dv
sen_rep_votes   long    %12.0g                USS_rv
pres_dem_ratio  float   %9.0g                 
pres_rep_ratio  float   %9.0g                 
sen_dem_ratio   float   %9.0g                 
sen_rep_ratio   float   %9.0g                 
partisan_inde~m float   %9.0g                 PartyIndexDem
partisan_inde~p float   %9.0g                 PartyIndexRep
------------------------------------------------------------------------------------------------------------------------
Sorted by: year  stcofips20
     Note: Dataset has changed since last saved.

. 
. * label variables
. label variable stcofips20 "County FIPS code"

. label variable year "Year"

. label variable reg_voters "# registered voters"

. label variable ballots_cast "Ballots cast in general election, all races"

. label variable cvap "Citizen voting age population"

. label variable reg_voters_pct "% eligible voters registered (reg_voters / cvap), top coded"

. label variable voter_turnout_pct "% eligible voters casting ballots (ballots_cast / cvap), top coded"

. label variable reg_voter_turnout_pct "% registered voters casting ballots (ballots_cast / reg_voters), top coded"

. label variable pres_dem_votes "# votes for Democratic presidential candidate"

. label variable pres_rep_votes "# votes for Republican presidential candidate"

. label variable sen_dem_votes "# votes for Democratic senate candidate"

. label variable sen_rep_votes "# votes for Republican senate candidate"

. label variable pres_dem_ratio "% votes for Democratic presidential candidate"

. label variable pres_rep_ratio "% votes for Republican presidential candidate"

. label variable sen_dem_ratio "% votes for Democratic senate candidate"

. label variable sen_rep_ratio "% votes for Republican senate candidate"

. label variable partisan_index_dem "Democratic partisanship index (% votes cast, past 6 years)"

. label variable partisan_index_rep "Republican partisanship index (% votes cast, past 6 years)"

. 
. * change data type of variables
. * Leaving as is to be consistent with previous version of dataset.
. 
. * Drop Duplicates
. tab year

       Year |      Freq.     Percent        Cum.
------------+-----------------------------------
       2018 |      3,271       33.56       33.56
       2020 |      3,260       33.45       67.01
       2022 |      3,215       32.99      100.00
------------+-----------------------------------
      Total |      9,746      100.00

. codebook stcofips20

------------------------------------------------------------------------------------------------------------------------
stcofips20                                                                                              County FIPS code
------------------------------------------------------------------------------------------------------------------------

                  Type: String (str5)

         Unique values: 3,261                     Missing "": 0/9,746

              Examples: "17087"
                        "26115"
                        "37095"
                        "48097"

. sort stcofips20 year

. quietly by stcofips20 year: gen dup = cond(_N==1,0,_n)

. drop if dup>1
(49 observations deleted)

. 
. ****************************************************************************
. * Section 3: QA
. describe

Contains data from datasets\workfiles_received\nanda_voting_County20_2018-2022.dta
 Observations:         9,697                  
    Variables:            19                  20 Sep 2024 10:24
------------------------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------------------------
stcofips20      str5    %9s                   County FIPS code
year            int     %8.0g                 Year
reg_voters      long    %12.0g                # registered voters
ballots_cast    long    %12.0g                Ballots cast in general election, all races
cvap            float   %9.0g                 Citizen voting age population
reg_voters_pct  float   %9.0g                 % eligible voters registered (reg_voters / cvap), top coded
voter_turnout~t float   %9.0g                 % eligible voters casting ballots (ballots_cast / cvap), top coded
reg_voter_tur~t float   %9.0g                 % registered voters casting ballots (ballots_cast / reg_voters), top coded
pres_dem_votes  long    %12.0g                # votes for Democratic presidential candidate
pres_rep_votes  long    %12.0g                # votes for Republican presidential candidate
sen_dem_votes   long    %12.0g                # votes for Democratic senate candidate
sen_rep_votes   long    %12.0g                # votes for Republican senate candidate
pres_dem_ratio  float   %9.0g                 % votes for Democratic presidential candidate
pres_rep_ratio  float   %9.0g                 % votes for Republican presidential candidate
sen_dem_ratio   float   %9.0g                 % votes for Democratic senate candidate
sen_rep_ratio   float   %9.0g                 % votes for Republican senate candidate
partisan_inde~m float   %9.0g                 Democratic partisanship index (% votes cast, past 6 years)
partisan_inde~p float   %9.0g                 Republican partisanship index (% votes cast, past 6 years)
dup             float   %9.0g                 
------------------------------------------------------------------------------------------------------------------------
Sorted by: stcofips20  year
     Note: Dataset has changed since last saved.

. summarize

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
  stcofips20 |          0
        year |      9,697    2019.999    1.629578       2018       2022
  reg_voters |      9,310    68714.21    217092.2          0    7412146
ballots_cast |      9,310    40451.08    119829.6          0    4263059
        cvap |      9,645    80162.26    256858.9          0    7843598
-------------+---------------------------------------------------------
reg_voters~t |      9,310    .8330258    .1928009         -1        .98
voter_turn~t |      9,310    .5213124    .1542696         -1        .98
reg_voter_~t |      9,304    .5793277    .2527373         -1        .98
pres_dem_v~s |      3,153    38893.26    145443.8          4    3122322
pres_rep_v~s |      3,153    36638.88    94561.48         59    2986995
-------------+---------------------------------------------------------
sen_dem_vo~s |      5,821    21198.47    70724.96          5    1670306
sen_rep_vo~s |      5,821    20608.36    44468.87          3     984203
pres_dem_r~o |      3,153    .3405569    .1635381   .0311355   .9446695
pres_rep_r~o |      3,153    .6594431    .1635381   .0553305   .9688644
sen_dem_ra~o |      5,821    .3488098    .1629868   .0277264   .9788733
-------------+---------------------------------------------------------
sen_rep_ra~o |      5,821    .6511902    .1629868   .0211268   .9722736
partisan_i~m |      8,062    .3616205     .161303   .0353677   .9788733
partisan_i~p |      8,062    .6383795     .161303   .0211268   .9646323
         dup |      9,697    .0017531    .0418357          0          1

. 
. *****************************************************************************
. * Section 4: apply standard naming convention
. save `curatedfile'
file datasets\nanda_voting_county_2018-2022_02.dta saved

. log close
      name:  <unnamed>
       log:  O:\NaNDA\Data\voting\voting_county_2018-2022\code\turnover_voting_county_2018-2022_02.log
  log type:  text
 closed on:  20 Sep 2024, 11:30:16
------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  O:\NaNDA\Data\voting\voting_county_2018-2022\code\turnover_voting_county_2018-2022_02.log
  log type:  text
 opened on:  20 Sep 2024, 11:30:16

. 
. describe, replace clear

. keep name type varlab

. rename name Variable

. rename type Type

. rename varlab Label

. 
. export excel using `dictionary2', firstrow(variables) replace
file documentation\nanda_voting_county_2018-2022_02_data_dictionary.xlsx saved

. log close
      name:  <unnamed>
       log:  O:\NaNDA\Data\voting\voting_county_2018-2022\code\turnover_voting_county_2018-2022_02.log
  log type:  text
 closed on:  20 Sep 2024, 11:30:17
------------------------------------------------------------------------------------------------------------------------
